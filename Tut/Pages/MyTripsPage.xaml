<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:Tut.Converters"
             xmlns:pageModels="clr-namespace:Tut.PageModels"
             xmlns:models="clr-namespace:Tut.Common.Models;assembly=Tut_Common"
             x:Class="Tut.Pages.MyTripsPage"
             x:DataType="pageModels:MyTripsPageModel"
             Shell.NavBarIsVisible="False">
    <ContentPage.Resources>
        <converters:TripStateToColorConverter x:Key="TripStateToColorConverter"/>
    </ContentPage.Resources>
            <VerticalStackLayout Padding="15" Spacing="10">
                <!-- Header -->
                <Label Text="My Trips" 
               FontSize="16" 
               HorizontalOptions="Center" 
               Margin="0,10,0,20" 
               FontAttributes="Bold"/>
                <!-- Tabs -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="0" HeightRequest="50" Margin="10,0,10,20" BackgroundColor="#F1F1F1" >
                    <Grid.Resources>
                        <Style TargetType="Button">
                            <Setter Property="BackgroundColor" Value="Transparent"/>
                            <Setter Property="CornerRadius" Value="10"/>
                            <Setter Property="HorizontalOptions" Value="Fill"/>
                            <Setter Property="TextColor" Value="Black"/>
                            <Setter Property="FontSize" Value="12"/>
                            <Setter Property="FontAttributes" Value="Bold"/>
                        </Style> 
                    </Grid.Resources>
                    <Button x:Name="SelectionBackground" BackgroundColor="White" Margin="20,5"/>
                    <Button x:Name="CompletedButton" Command="{Binding SelectCompletedCommand}" Text="Completed" Grid.Column="0" />
                    <Button x:Name="UpcomingButton" Command="{Binding SelectUpcomingCommand}" Text="Upcoming" Grid.Column="1"/>
                </Grid>
                <!-- Trip Details -->
                    <CollectionView x:Name="UpcomingTrips" IsVisible="{Binding UpcomingTripsVisible}">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" />
                        </CollectionView.ItemsLayout>

                        <CollectionView.EmptyView>
                            <Label Text="No upcoming trips available." 
                   HorizontalOptions="Center" 
                   VerticalOptions="Center" 
                   TextColor="Gray" />
                        </CollectionView.EmptyView>

                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Trip">
                                <VerticalStackLayout Spacing="5">
                                    <Border BackgroundColor="White" StrokeThickness="0" Padding="10">
                                        <VerticalStackLayout Spacing=" 10">
                                            <Grid ColumnDefinitions="*,auto" Margin="0,0,0,10">
                                                <Label Text="Today, 07:00 am" FontSize="14" FontAttributes="Bold" />

                                                <Label Grid.Column="1" FontSize="11" Text="completed" TextColor="Green" HorizontalOptions="End"/>
                                            </Grid>

                                            <Grid ColumnDefinitions="auto,*" ColumnSpacing="10" >
                                                <HorizontalStackLayout Spacing="5">
                                                    <Image Source="driver.png" 
                                           HeightRequest="50" 
                                           WidthRequest="50" 
                                           Aspect="AspectFill" />
                                                    <Label Text="Karim Adel" 
                                           FontSize="16"
                                           VerticalOptions="Center"
                                           FontAttributes="Bold" />

                                                </HorizontalStackLayout>
                                                <HorizontalStackLayout Grid.Column="1" HorizontalOptions="End" Spacing="10">
                                                    <VerticalStackLayout Spacing="5">
                                                        <Label Text="Final cost "
                                               FontSize="14" 
                                               TextColor="#9C9C9C"  />
                                                        <Label Text="{Binding ActualCost}" 
                                               FontSize="14"
                                               FontAttributes="Bold" />
                                                    </VerticalStackLayout>
                                                    <VerticalStackLayout Spacing="5">
                                                        <Label Text="Time" FontSize="14" TextColor="#9C9C9C" />
                                                        <Label Text="15:00" FontSize="14" FontAttributes="Bold"/>
                                                    </VerticalStackLayout>
                                                </HorizontalStackLayout>


                                            </Grid>
                                            <BoxView HeightRequest="1" BackgroundColor="{StaticResource Gray500}" />

                                            <!--Location -->
                                            <VerticalStackLayout Spacing="10">
                                                <!--from-->
                                                <Grid ColumnDefinitions="*,auto" Padding="10" ColumnSpacing="10">
                                                    <HorizontalStackLayout Grid.Column="0" Spacing="5">
                                                        <Image Source="oval2.png" 
                                                    HeightRequest="16" 
                                                    WidthRequest="16" 
                                                    VerticalOptions="Start" />
                                                        <Label Text="Almaza, Cairo" FontSize="12" FontAttributes="Bold"/>
                                                    </HorizontalStackLayout>
                                                    <Label Grid.Column="1" Text="07:00 am" FontSize="12" TextColor="#9C9C9C" VerticalOptions="Start"/>
                                                </Grid>
                                                <!--to-->
                                                <Grid ColumnDefinitions="*,auto" Padding="10" ColumnSpacing="10">
                                                    <HorizontalStackLayout Grid.Column="0" Spacing="5">
                                                        <Image Source="oval.png" HeightRequest="16" WidthRequest="16" Margin="0,-20,0,0"/>

                                                        <Label Text="City Stars, Cairo" FontSize="12" FontAttributes="Bold" Margin="0,-20,0,0" />
                                                    </HorizontalStackLayout>
                                                    <Label Grid.Column="1" Text="07:15 am" FontSize="12" TextColor="#9C9C9C" Margin="0,-20,0,0" />
                                                </Grid>
                                            </VerticalStackLayout>
                                        </VerticalStackLayout>
                                    </Border>
                                    <BoxView VerticalOptions="End" HeightRequest="10"  BackgroundColor="{StaticResource Gray500}"/>
                                </VerticalStackLayout>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    <CollectionView x:Name="CompletedTrips" IsVisible="{Binding CompletedTripsVisible}"  
                        BackgroundColor="Transparent" HeightRequest="700"
                        ItemsSource="{Binding Trips}"
                        SelectionChangedCommand="{Binding TripSelectedCommand}"
                        SelectionChangedCommandParameter="{Binding SelectedItem, Source={RelativeSource Self}}"
                        SelectedItem="{Binding SelectedTrip}"
                        SelectionMode="Single">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical" ItemSpacing="10" />
                        </CollectionView.ItemsLayout>
                        <CollectionView.EmptyView>
                            <Label Text="No completed trips available." 
                   HorizontalOptions="Center" 
                   VerticalOptions="Center" 
                   TextColor="Gray" />
                        </CollectionView.EmptyView>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border BackgroundColor="White" StrokeThickness="0" Padding="10">
                                    <VerticalStackLayout Spacing=" 10">
                                        <Grid ColumnDefinitions="*,auto" Margin="0,0,0,10">
                                        <Label Text="{Binding StartTime, StringFormat='{0:dd/MM/yyyy}'}" FontSize="14" FontAttributes="Bold" />

                                            <Label Grid.Column="1" FontSize="11" Text="{Binding Status}" TextColor="{Binding Status, Converter={StaticResource TripStateToColorConverter}}" HorizontalOptions="End"/>
                                        </Grid>
                                        <Grid ColumnDefinitions="auto,*" ColumnSpacing="10" >
                                            <HorizontalStackLayout Spacing="5">
                                                <Image Source="driver.png" 
                                           HeightRequest="50" 
                                           WidthRequest="50" 
                                           Aspect="AspectFill" />
                                                <VerticalStackLayout Spacing="5">
                                                    <Label Text="{Binding Driver.FullName}" 
                                           FontSize="16"
                                           VerticalOptions="Center"
                                           FontAttributes="Bold" />
                                                    <Label Text="Private" TextColor="#8E8D88"
                                           FontSize="12"/>
                                                </VerticalStackLayout>

                                            </HorizontalStackLayout>
                                            <HorizontalStackLayout Grid.Column="1" HorizontalOptions="End" Spacing="10">
                                                <VerticalStackLayout Spacing="5">
                                                    <Label Text="Final cost "
                                               FontSize="14" 
                                               TextColor="#9C9C9C"  />
                                                    <Label Text="{Binding ActualCost,StringFormat='{0:00} LE'}"  
                                               FontSize="14"
                                               FontAttributes="Bold" />
                                                </VerticalStackLayout>
                                                <!--<VerticalStackLayout Spacing="5">
                                        <Label Text="Time" FontSize="14" TextColor="#9C9C9C" />
                                        <Label Text="15:00" FontSize="14" FontAttributes="Bold"/>
                                    </VerticalStackLayout>-->
                                            </HorizontalStackLayout>


                                        </Grid>
                                        <BoxView HeightRequest="1" BackgroundColor="{StaticResource Gray500}" />

                                        <!--Location -->
                                        <VerticalStackLayout Spacing="10">
                                            <!--from-->
                                            <Grid ColumnDefinitions="*,auto" Padding="0, 10" ColumnSpacing="10">
                                                <HorizontalStackLayout Grid.Column="0" Spacing="5">
                                                    <Image Source="oval2.png" 
                                                HeightRequest="16" 
                                                WidthRequest="16" 
                                                VerticalOptions="Start" />
                                                    <Label Text="{Binding Stops[0].Address}" FontSize="12" FontAttributes="Bold"/>
                                                </HorizontalStackLayout>
                                                <Label Grid.Column="1" Text="{Binding StartTime}" FontSize="12" TextColor="#9C9C9C" VerticalOptions="Start"/>
                                            </Grid>
                                            <!--to-->
                                            <Grid ColumnDefinitions="*,auto" Padding="0, 10" ColumnSpacing="10">
                                                <HorizontalStackLayout Grid.Column="0" Spacing="5">
                                                    <Image Source="oval.png" HeightRequest="16" WidthRequest="16" Margin="0,-20,0,0"/>

                                                    <Label Text="{Binding Stops[^1].Address}" FontSize="12" FontAttributes="Bold" Margin="0,-20,0,0" />
                                                </HorizontalStackLayout>
                                                <Label Grid.Column="1" Text="{Binding EndTime}" FontSize="12" TextColor="#9C9C9C" Margin="0,-20,0,0" />
                                            </Grid>
                                        </VerticalStackLayout>
                                    </VerticalStackLayout>
                                </Border>

                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
            </VerticalStackLayout>
    
</ContentPage>
